<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Solar System</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Segoe UI', sans-serif;
            color: white;
        }

        /* UI Overlay */
        #ui-container {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 220px;
            z-index: 10;
        }

        /* Controls */
        button {
            background: #4facfe;
            border: none;
            padding: 10px;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover {
            background: #00f2fe;
        }

        label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 2px;
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
        }

        /* Info Panel */
        #info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 15, 30, 0.85);
            padding: 20px;
            border-left: 4px solid #4facfe;
            border-radius: 5px;
            width: 300px;
            transform: translateX(-120%);
            transition: transform 0.4s ease;
            z-index: 10;
        }

        #info-panel.visible {
            transform: translateX(0);
        }

        #info-panel h2 {
            margin: 0 0 10px 0;
            color: #4facfe;
            text-transform: uppercase;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 4px;
        }

        /* Labels (CSS2D) */
        .planet-label {
            color: rgba(255, 255, 255, 0.8);
            font-family: sans-serif;
            padding: 2px 5px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 4px;
            font-size: 10px;
            pointer-events: none;
            margin-top: 15px;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>

    <div id="ui-container">
        <h3>Solar Control</h3>
        <button id="btn-pause">Pause / Play</button>
        <button id="btn-reset">Reset View</button>
        <button id="btn-orbits">Toggle Orbits</button>

        <label for="speed-slider">Sim Speed</label>
        <input type="range" id="speed-slider" min="0" max="2" step="0.1" value="0.5">
    </div>

    <div id="info-panel">
        <h2 id="p-name">Earth</h2>
        <div class="data-row"><span>Diameter:</span> <span id="p-dia">-</span></div>
        <div class="data-row"><span>Distance:</span> <span id="p-dist">-</span></div>
        <div class="data-row"><span>Day Length:</span> <span id="p-day">-</span></div>
        <div class="data-row"><span>Year Length:</span> <span id="p-year">-</span></div>
        <div style="margin-top:10px; font-size: 12px; color: #888;">*Data is relative/scaled</div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // --- CONFIGURATION ---
        const CONFIG = {
            sunRadius: 10,
            orbitSpeedMult: 0.5,
            paused: false,
            showOrbits: true
        };

        // Planet Data (Relative scales for visualization, not 1:1 physics)
        const PLANET_DATA = [
            { name: "Mercury", size: 2.2, distance: 20, color: 0xA5A5A5, speed: 0.04, info: { dia: "4,880 km", dist: "57M km", day: "58d", year: "88d" } },
            { name: "Venus", size: 3.5, distance: 35, color: 0xE3BB76, speed: 0.015, info: { dia: "12,104 km", dist: "108M km", day: "243d", year: "225d" } },
            { name: "Earth", size: 3.8, distance: 50, color: 0x2233FF, speed: 0.01, info: { dia: "12,742 km", dist: "149M km", day: "24h", year: "365d" } },
            { name: "Mars", size: 2.8, distance: 65, color: 0xDA4E3C, speed: 0.008, info: { dia: "6,779 km", dist: "227M km", day: "24.6h", year: "687d" } },
            { name: "Jupiter", size: 8.5, distance: 100, color: 0xD6A566, speed: 0.002, info: { dia: "139,820 km", dist: "778M km", day: "9.9h", year: "12y" } },
            { name: "Saturn", size: 7.5, distance: 140, color: 0xF4D03F, speed: 0.0009, ring: { inner: 9, outer: 14, color: 0xC0A060 }, info: { dia: "116,460 km", dist: "1.4B km", day: "10.7h", year: "29y" } },
            { name: "Uranus", size: 5.0, distance: 180, color: 0x73C6D9, speed: 0.0004, info: { dia: "50,724 km", dist: "2.8B km", day: "17h", year: "84y" } },
            { name: "Neptune", size: 4.8, distance: 210, color: 0x3E54E8, speed: 0.0001, info: { dia: "49,244 km", dist: "4.5B km", day: "16h", year: "165y" } }
        ];

        // --- CLASS DEFINITIONS ---

        // 1. Scene Manager
        class SceneManager {
            constructor() {
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);
                this.camera.position.set(0, 100, 250);

                // WebGL Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                document.body.appendChild(this.renderer.domElement);

                // CSS 2D Renderer (Labels)
                this.labelRenderer = new CSS2DRenderer();
                this.labelRenderer.setSize(window.innerWidth, window.innerHeight);
                this.labelRenderer.domElement.style.position = 'absolute';
                this.labelRenderer.domElement.style.top = '0px';
                this.labelRenderer.domElement.style.pointerEvents = 'none'; // Click through to canvas
                document.body.appendChild(this.labelRenderer.domElement);

                // Controls
                this.controls = new OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;

                // Lighting
                const ambientLight = new THREE.AmbientLight(0x333333);
                this.scene.add(ambientLight);

                // Interaction
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();

                // Add Stars
                this.addStars();

                // Responsive
                window.addEventListener('resize', () => this.onResize());

                // Click Listener (attached to canvas, logic handled in main)
                window.addEventListener('pointerdown', (e) => this.onMouseClick(e));
            }

            addStars() {
                const geometry = new THREE.BufferGeometry();
                const count = 5000;
                const positions = new Float32Array(count * 3);
                for (let i = 0; i < count * 3; i++) {
                    positions[i] = (Math.random() - 0.5) * 1500;
                }
                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                const material = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5, transparent: true, opacity: 0.8 });
                const stars = new THREE.Points(geometry, material);
                this.scene.add(stars);
            }

            onResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.labelRenderer.setSize(window.innerWidth, window.innerHeight);
            }

            onMouseClick(event) {
                this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                this.raycaster.setFromCamera(this.mouse, this.camera);
            }
        }

        // 2. The Sun (with Shader)
        class Sun {
            constructor(scene) {
                // Vertex Shader: Standard projection
                const vertexShader = `
                    varying vec2 vUv;
                    void main() {
                        vUv = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `;

                // Fragment Shader: Pulsating heat effect
                const fragmentShader = `
                    uniform float time;
                    varying vec2 vUv;
                    
                    // Simple noise function
                    float noise(vec2 p) {
                        return sin(p.x * 10.0 + time) * sin(p.y * 10.0 + time);
                    }

                    void main() {
                        vec3 colorA = vec3(1.0, 0.5, 0.0); // Orange
                        vec3 colorB = vec3(1.0, 0.1, 0.0); // Red/Yellow
                        float intensity = 0.5 + 0.5 * noise(vUv * 2.0);
                        vec3 finalColor = mix(colorA, colorB, intensity);
                        // Make center brighter
                        float glow = 1.0; 
                        gl_FragColor = vec4(finalColor * glow, 1.0);
                    }
                `;

                this.uniforms = { time: { value: 1.0 } };
                const geometry = new THREE.SphereGeometry(CONFIG.sunRadius, 32, 32);
                const material = new THREE.ShaderMaterial({
                    uniforms: this.uniforms,
                    vertexShader: vertexShader,
                    fragmentShader: fragmentShader,
                });

                this.mesh = new THREE.Mesh(geometry, material);

                // Add a PointLight so the sun actually illuminates planets
                const light = new THREE.PointLight(0xffffff, 2, 400);
                this.mesh.add(light);

                // Lensflare simulation (simple sprites)
                const glowGeo = new THREE.PlaneGeometry(60, 60);
                const glowMat = new THREE.MeshBasicMaterial({
                    color: 0xffaa00, transparent: true, opacity: 0.15,
                    side: THREE.DoubleSide, depthWrite: false, blending: THREE.AdditiveBlending
                });
                const glowMesh = new THREE.Mesh(glowGeo, glowMat);
                glowMesh.lookAt(scene.camera.position);
                this.mesh.add(glowMesh); // Child of sun

                scene.add(this.mesh);
            }

            update(time) {
                this.uniforms.time.value = time;
                this.mesh.rotation.y += 0.002;
            }
        }

        // 3. Planet Class
        class Planet {
            constructor(scene, data) {
                this.data = data;
                this.angle = Math.random() * Math.PI * 2; // Random starting pos
                this.scene = scene;

                // Group to hold planet + label
                this.meshObj = new THREE.Group();

                // 1. Create Mesh
                // Note: Using standard material + colors to avoid texture loading CORS issues locally.
                // You can swap map: null with map: textureLoader.load('url') if you have a local server.
                const geometry = new THREE.SphereGeometry(data.size, 32, 32);
                const material = new THREE.MeshStandardMaterial({
                    color: data.color,
                    roughness: 0.7,
                    metalness: 0.1
                });

                this.planetMesh = new THREE.Mesh(geometry, material);
                this.planetMesh.castShadow = true;
                this.planetMesh.receiveShadow = true;

                // User Data for raycasting identification
                this.planetMesh.userData = { isPlanet: true, info: data.info, name: data.name };

                this.meshObj.add(this.planetMesh);

                // 2. Rings (Saturn specific)
                if (data.ring) {
                    const ringGeo = new THREE.RingGeometry(data.ring.inner, data.ring.outer, 32);
                    const ringMat = new THREE.MeshBasicMaterial({
                        color: data.ring.color, side: THREE.DoubleSide, transparent: true, opacity: 0.6
                    });
                    const ring = new THREE.Mesh(ringGeo, ringMat);
                    ring.rotation.x = -Math.PI / 2;
                    this.meshObj.add(ring);
                }

                // 3. Label
                const div = document.createElement('div');
                div.className = 'planet-label';
                div.textContent = data.name;
                const label = new CSS2DObject(div);
                label.position.set(0, data.size + 1, 0);
                this.meshObj.add(label);

                // 4. Orbit Path Line
                const orbitCurve = new THREE.EllipseCurve(
                    0, 0,            // ax, aY
                    data.distance, data.distance, // xRadius, yRadius
                    0, 2 * Math.PI,  // aStartAngle, aEndAngle
                    false,           // aClockwise
                    0                // aRotation
                );

                const points = orbitCurve.getPoints(100);
                const orbitGeo = new THREE.BufferGeometry().setFromPoints(points);
                const orbitMat = new THREE.LineBasicMaterial({ color: 0x444444, transparent: true, opacity: 0.3 });
                this.orbitLine = new THREE.Line(orbitGeo, orbitMat);
                this.orbitLine.rotation.x = -Math.PI / 2;

                scene.add(this.orbitLine);
                scene.add(this.meshObj);
            }

            update(deltaTime) {
                if (!CONFIG.paused) {
                    // Orbit Calculation
                    this.angle += this.data.speed * CONFIG.orbitSpeedMult;
                    const x = Math.cos(this.angle) * this.data.distance;
                    const z = Math.sin(this.angle) * this.data.distance;
                    this.meshObj.position.set(x, 0, z);

                    // Self Rotation
                    this.planetMesh.rotation.y += 0.01;
                }

                // Toggle Orbit Visibility
                this.orbitLine.visible = CONFIG.showOrbits;
            }
        }

        // --- MAIN APP ---

        const app = new SceneManager();
        const sun = new Sun(app.scene);
        const planets = [];

        // Initialize Planets
        PLANET_DATA.forEach(data => {
            planets.push(new Planet(app.scene, data));
        });

        // UI Managers
        const uiInfo = document.getElementById('info-panel');
        const uiName = document.getElementById('p-name');
        const uiDia = document.getElementById('p-dia');
        const uiDist = document.getElementById('p-dist');
        const uiDay = document.getElementById('p-day');
        const uiYear = document.getElementById('p-year');

        // Logic for Clicking Planets
        window.addEventListener('pointerdown', () => {
            const intersects = app.raycaster.intersectObjects(app.scene.children, true);

            if (intersects.length > 0) {
                // Find the first object that is a planet mesh
                const hit = intersects.find(obj => obj.object.userData.isPlanet);

                if (hit) {
                    const data = hit.object.userData;
                    uiName.innerText = data.name;
                    uiDia.innerText = data.info.dia;
                    uiDist.innerText = data.info.dist;
                    uiDay.innerText = data.info.day;
                    uiYear.innerText = data.info.year;
                    uiInfo.classList.add('visible');

                    // Focus camera on planet (Simple offset)
                    // app.controls.target.copy(hit.object.parent.position);
                } else {
                    uiInfo.classList.remove('visible');
                }
            } else {
                uiInfo.classList.remove('visible');
            }
        });

        // DOM UI Controls
        document.getElementById('btn-pause').onclick = () => CONFIG.paused = !CONFIG.paused;
        document.getElementById('btn-orbits').onclick = () => CONFIG.showOrbits = !CONFIG.showOrbits;
        document.getElementById('speed-slider').oninput = (e) => CONFIG.orbitSpeedMult = parseFloat(e.target.value);
        document.getElementById('btn-reset').onclick = () => {
            app.controls.reset();
            app.camera.position.set(0, 100, 250);
        };

        // Animation Loop
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            const elapsedTime = clock.getElapsedTime();

            sun.update(elapsedTime);
            planets.forEach(p => p.update(delta));

            app.controls.update();
            app.renderer.render(app.scene, app.camera);
            app.labelRenderer.render(app.scene, app.camera);
        }

        animate();

    </script>
</body>

</html>